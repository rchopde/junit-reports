shared:
  image: golang:latest

jobs:
  validate:
    requires: [~pr, ~commit]
    steps:
      - validate: sd-cmd validate -f ./sd-command.yaml
      - install-bats: |
          sudo yum install -y y-epel-release
          sudo yum install -y bats --enablerepo epel
      test: bats -t tests.sh | tee ${TEST_DIR}/tests.sh.tap

  publish-stable:
    steps:
      - publish: sd-cmd publish -f ./sd-command.yaml -t stable

  publish-latest:
    requires: [validate]
    steps:
      - publish: sd-cmd publish -f ./sd-command.yaml

  promote:
    requires: [publish]
    steps:
      - promote: sd-cmd promote screwdriver-cd/junit-tests latest stable
